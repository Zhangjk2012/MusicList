var datagrid;var songlistgrid;var selectSongListGrid;var albumSelect;$(function(){datagrid=$("#albumlist").datagrid({url:"admin/albumlist",isField:"id",pagination:true,rownumbers:true,title:"音乐专辑",fit:true,fitColumns:true,loadMsg:"Loading...",singleSelect:true,frozenColumns:[[{field:"ck",checkbox:true}]],columns:[[{field:"id",title:"id",hidden:true},{field:"name",title:"专辑名称",width:50},{field:"singer",title:"singer",hidden:true},{field:"singerName",title:"歌手",width:50},{field:"publishTime",title:"发行日期",width:50},{field:"publishCompany",title:"发行公司",width:50},{field:"briefIntroduction",title:"专辑简介",width:50,formatter:function(G,F){if(G==undefined||G==""){return""}var D="";if(G.length>20){D=G.substr(0,20)+"..."}else{D=G}var E='<span title="'+G+'" class="note">'+D+"</span>";return E}},{field:"picture",title:"专辑图片",width:50,formatter:function(E,D){if(E==undefined||E==""){return""}return'<img width=30 height=30 src="'+D.picture+'" alt="专辑图片" />'}},]],onLoadSuccess:function(D){$(".note").tooltip({onShow:function(){$(this).tooltip("tip").css({width:"300",boxShadow:"1px 1px 3px #292929"})}})},onClickRow:function(E,D){showSongs(D.id)},toolbar:[{text:"增加专辑",iconCls:"icon-add",handler:function(){winOpen()}},"-",{text:"删除专辑",iconCls:"icon-remove",handler:function(){var D=datagrid.datagrid("getSelected");if(D<=0){$.messager.alert("警告","您没有选择","error")}else{$.messager.confirm("确定","您确定要删除吗",function(E){if(E){$.ajax({url:"admin/deleteAlbum",data:D,method:"post",dataType:"json",success:function(F){if(F.success){$.messager.show({msg:"删除成功。",title:"成功"});datagrid.datagrid("reload");songlistgrid.datagrid("loadData",{total:0,rows:[]})}else{$.messager.alert("错误","删除失败。","error")}}})}})}}},"-",{text:"修改专辑",iconCls:"icon-edit",handler:function(){var D=datagrid.datagrid("getSelected");if(D<=0){$.messager.alert("警告","您没有选择","error")}else{winUpdateOpen(D)}}},"-",{text:"添加音乐",iconCls:"icon-add",handler:function(){var D=datagrid.datagrid("getSelected");if(D<=0){$.messager.alert("警告","您没有选择专辑！","error")}else{albumSelect=D.id;$("#songListWin").window("open")}}}]});var B=$("#albumlist").datagrid("getPager");$(B).pagination({pageSize:20,pageList:[20],beforePageText:"第",afterPageText:"页    共 {pages} 页",displayMsg:"当前显示 {from} - {to} 条记录   共 {total} 条记录"});songlistgrid=$("#songlist").datagrid({isField:"id",title:"专辑所有音乐",pagination:false,rownumbers:true,loadMsg:"Loading...",fit:true,fitColumns:true,singleSelect:true,frozenColumns:[[{field:"ck",checkbox:true}]],columns:[[{field:"id",title:"id",hidden:true},{field:"songName",title:"歌曲名称",width:50},{field:"singerName",title:"歌手",width:50},{field:"albumName",title:"专辑",width:50},{field:"songFlag",title:"MP3/MP4",width:50,formatter:function(F,E){if(F==undefined){return""}var D;if(F===true){D="MP3"}else{D="MP4"}return D}},{field:"briefIntroduction",title:"歌曲简介",width:50,formatter:function(G,F){if(G==undefined||G==""){return""}var D="";if(G.length>20){D=G.substr(0,20)+"..."}else{D=G}var E='<span title="'+G+'" class="note">'+D+"</span>";return E}},{field:"picture",title:"歌曲图片",width:50,formatter:function(E,D){if(E==undefined||E==""){return""}return'<img width=30 height=30 src="'+D.picture+'" alt="歌曲图片" />'}},]],onLoadSuccess:function(D){$(".note").tooltip({onShow:function(){$(this).tooltip("tip").css({width:"300",boxShadow:"1px 1px 3px #292929"})}})},toolbar:[{text:"删除",iconCls:"icon-remove",handler:function(){var D=songlistgrid.datagrid("getSelected");if(D<=0){$.messager.alert("警告","您没有选择","error")}else{$.messager.confirm("确定","您确定要删除吗",function(E){if(E){$.ajax({url:"admin/deleteSelectSongs",data:{songId:D.id},method:"post",dataType:"json",success:function(F){if(F.success){$.messager.show({msg:"删除成功。",title:"成功"});songlistgrid.datagrid("reload")}else{$.messager.alert("错误","删除失败。","error")}}})}})}}}]});selectSongListGrid=$("#selectsonglist").datagrid({isField:"id",pagination:true,rownumbers:true,loadMsg:"Loading...",fit:true,fitColumns:true,singleSelect:false,toolbar:"#tb",frozenColumns:[[{field:"ck",checkbox:true}]],columns:[[{field:"songName",title:"歌曲名称",width:50},{field:"singerName",title:"歌手",width:50},{field:"albumName",title:"专辑",width:50},{field:"songFlag",title:"MP3/MP4",width:50,formatter:function(F,E){if(F==undefined){return""}var D;if(F===true){D="MP3"}else{D="MP4"}return D}}]],onLoadSuccess:function(D){$(".note").tooltip({onShow:function(){$(this).tooltip("tip").css({width:"300",boxShadow:"1px 1px 3px #292929"})}})}});$("#songListWin").window({width:800,height:500,modal:true,closed:true,resizable:false,minimizable:false,maximizable:false,collapsible:false,footer:"#songListWinFooter",onBeforeClose:function(){},onOpen:function(){selectSongListGrid.datagrid({url:"admin/getselectsonglist"}).datagrid("getPager").pagination({pageSize:50,pageList:[20,50,100],beforePageText:"第",afterPageText:"页    共 {pages} 页",displayMsg:"当前显示 {from} - {to} 条记录   共 {total} 条记录"})}});$("#win").window({width:500,height:500,modal:true,closed:true,resizable:false,minimizable:false,maximizable:false,collapsible:false,footer:"#addFooter",onBeforeClose:function(){clearForm()},onOpen:function(){A.combobox("reload","admin/singercombolist")}});createImgUpload("file_upload","fileQueue",function(D,E){$("#picture").val(E);$("#img").attr("src",E)});createImgUpload("update_upload","updateQueue",function(D,E){$("#updatePicture").val(E);$("#updateImg").attr("src",E)});$("#updateWin").window({width:500,height:500,modal:true,closed:true,minimizable:false,maximizable:false,collapsible:false,footer:"#updateFooter",onBeforeClose:function(){clearUpdateForm()},onOpen:function(){C.combobox("reload","admin/singercombolist")}});var A=$("#singer").combobox({valueField:"id",textField:"name",editable:false});var C=$("#updateSinger").combobox({valueField:"id",textField:"name",editable:false})});function submitForm(){$("#albumform").form("submit",{onSubmit:function(){return $(this).form("enableValidation").form("validate")},success:function(A){$.messager.show({msg:"添加成功。",title:"成功"});$("#win").window("close");$("#albumlist").datagrid("reload")}})}function clearForm(){$("#albumform").form("reset");clearUploadFile("file_upload");$("#img").attr("src","")}function closeWin(){$("#win").window("close");$("#img").attr("src","")}function winOpen(){$("#win").window("open")}function clearUplaoder(){clearUploadFile("file_upload");$("#picture").val("");$("#img").attr("src","")}function submitUpdateForm(){$("#updateform").form("submit",{onSubmit:function(){return $(this).form("enableValidation").form("validate")},success:function(A){$.messager.show({msg:"修改成功。",title:"成功"});$("#updateWin").window("close");$("#albumlist").datagrid("reload")}})}function clearUpdateForm(){$("#updateform").form("reset");clearUploadFile("update_upload");$("#updateImg").attr("src","")}function closeUpdateWin(){$("#updateWin").window("close");$("#updateImg").attr("src","")}function winUpdateOpen(A){$("#updateWin").window("open");$("#updateform").form("load",A);$("#updateImg").attr("src",A.picture)}function clearUpdateUplaoder(){clearUploadFile("update_upload");$("#updatePicture").val("");$("#updateImg").attr("src","")}function searchSongs(){selectSongListGrid.datagrid({queryParams:{"songName":$("#songName").val()}})}function addSongsOK(){var B=selectSongListGrid.datagrid("getSelections");if(B<=0){$("#songName").textbox("clear");$("#songListWin").window("close")}else{var C=new Array();for(var A=0;A<B.length;A++){C.push(B[A].id)}$.ajax({url:"admin/addSongs2Album",data:{songsId:C,albumId:albumSelect},type:"post",cache:false,dataType:"json",success:function(D){if(D===true){$.messager.show({msg:"添加成功。",title:"成功"});songlistgrid.datagrid("reload")}else{$.messager.show({msg:"添加失败。",title:"失败"})}},error:function(){alert("异常！")}})}$("#songName").textbox("clear");$("#songListWin").window("close")}function cancelAddSong(){$("#songName").textbox("clear");$("#songListWin").window("close")}function showSongs(A){songlistgrid.datagrid({url:"admin/selectSongs",queryParams:{albumId:A}})};