var pageIndex=1;var pageSize=15;$(function(){$.ajax({url:"getCategory",type:"post",cache:false,dataType:"json",success:function(D){if(D.msg=="true"){var A=D.data;var C=A.length;if(A.length==0){}else{var B=$("#categoryId").val();$.each(A,function(F,G){var E="";if(B==""){$("#categoryId").val(G.id);E='<li data="'+G.id+'" class="mine z-selected">';B=G.id;getAllSongsByCategory(G.id);setTitleInfo(G.picture,G.name);getCommentCount(G.id)}else{if(G.id==B){E='<li data="'+G.id+'" class="mine z-selected">';getAllSongsByCategory(G.id);setTitleInfo(G.picture,G.name);getCommentCount(G.id)}else{E='<li data="'+G.id+'" class="mine">'}}E+='<input type="hidden" value="'+G.id+'"/>';E+='<div class="item f-cb"><div class="left">';E+='<a class="avatar" href="javascript:selectTopList('+G.id+",'"+G.name+"','"+G.picture+'\')"><img src="'+G.picture+'" alt="'+G.name+'" width="40" height="40"><span class="msk"></span></a>';E+='</div><p class="name"><a href="javascript:selectTopList('+G.id+",'"+G.name+"','"+G.picture+'\')" class="s-fc0">'+G.name+"</a></p>";E+=" </div></li>";$("#categoryTitle").append(E)})}}},error:function(){}})});function selectTopList(C,A,B){$("#tBody").html("");$("#totalSong").html("");$("#categoryId").val(C);$("#commentCount1").html("");$("#totalSong").html("");$("#commentContent").html("");getAllSongsByCategory(C);setTitleInfo(B,A);getCommentCount(C);$("#categoryTitle li").each(function(D,E){if($(this).attr("data")==C){$(this).attr("class","mine z-selected")}else{$(this).attr("class","mine")}})}function getCommentCount(A){$.ajax({url:"getCategorySongCommentsCount",type:"post",cache:false,data:{id:A},dataType:"json",success:function(B){if(B.msg=="true"){$("#Pagination").pagination({dataSource:function(C){var E=[];var G=B.commentCount;$("#commentCount1").html(B.commentCount);var F=G/pageSize+1;for(var D=1;D<F;D++){E.push(D)}C(E)},callback:pageCallback,prevText:"« 上一页",nextText:"下一页 »",pageRange:4,pageSize:1})}},error:function(){}})}function getAllSongsByCategory(A){$.ajax({url:"getSongsByCategoryId",type:"post",data:{id:A},cache:false,dataType:"json",success:function(E){if(E.msg=="true"){var B=E.data;var D=B.length;$("#totalSong").html(E.total);if(B.length==0){}else{var C=1;$.each(B,function(G,H){var F="";if(C%2==0){F+="<tr>"}else{F+='<tr class="even">'}F+='<td><div class="hd"><span class="num">'+C+"</span></div></td>";F+='<td><div class="f-cb">';F+='<div class="tt">';F+='<a href="javascript:;" onclick="play(\''+H.songPath+"','"+H.songName+"')\">";F+='<span class="ply ">&nbsp;</span></a>';F+='<div class="ttc">';F+='<span class="txt"><a href="javascript:goPage(\'playmusic\','+H.id+')"><b title="'+H.songName+'">'+H.songName+"</b></a></span></div></div>";F+="</div></td>";F+='<td class=" s-fc3">'+H.trackLength+"</td>";F+='<td><div class="text" title="'+H.singerName+'">';F+='<span title="'+H.singerName+'"><a';F+='href="javascript:;" hidefocus="true">'+H.singerName+"</a></span></div></td>";C++;$("#tBody").append(F)})}}},error:function(){}})}function pageCallback(C,A){$("#commentContent").html("");var B=$("#categoryId").val();$.ajax({url:"commentlist",data:{rows:pageSize,songId:B,page:C[0],type:3},type:"post",cache:false,dataType:"json",success:function(F){if(F.msg=="true"){var D=F.data;var E=D.length;if(D.length==0){}else{$.each(D,function(H,I){var G="";G+='<div class="itm">';G+='<div class="head">';G+='<img src="images/head.jpg">';G+="</div>";G+='<div class="cntwrap">';G+='<div class="">';G+='<div class="cnt f-brk">';G+=I.ip+"："+I.content;G+="</div>";G+="</div>";G+='<div class="rp">';G+='<div class="time s-fc4">'+I.time+"</div>";G+='<a href="javascript:;" onclick="voteNum(\''+I.id+'\',this);"><i class="zan u-icn2 u-icn2-12"></i> <span>'+I.supportNum+"</span></a>";G+="</div>";G+="</div>";G+="</div>";$("#commentContent").append(G)})}}}})}function setTitleInfo(C,B){var A='<div class="cover u-cover u-cover-rank">';A+='<img src="'+C+'" width="150" height="150"><span class="msk"></span></div>';A+='<div class="cnt"><div class="cntc m-info"><div class="hd f-cb">';A+='<h2 class="f-ff2">'+B+"</h2></div></div></div>";$("#titleInfo").html("");$("#titleInfo").append(A)}function voteNum(B,A){$.ajax({url:"addCommentSupportNum",type:"post",cache:false,data:{"id":B},dataType:"json",success:function(D){if(D.success=="true"){var C=parseInt($("> span",A).html());$("> span",A).html(C+1)}else{alert("点赞失败。")}}})}function songVoteNum(B,A){$.ajax({url:"addSongSupportNum",type:"post",cache:false,data:{"id":B},dataType:"json",success:function(D){if(D.success=="true"){var C=parseInt($("> span",A).html());$("> span",A).html(C+1)}else{alert("点赞失败。")}}})}function comment(){var A=$("#commentContext").val();var B=$("#categoryId").val();$.ajax({url:"addComment",type:"post",cache:false,data:{"content":A,"id":B,type:3},dataType:"json",success:function(D){if(D.success=="true"){var C=D.commentCount;$("#commentContext").val("");$("#commentCount1").html(C);$("#Pagination").pagination({dataSource:function(E){var G=[];var I=C;var H=I/pageSize+1;for(var F=1;F<H;F++){G.push(F)}E(G)},callback:pageCallback,prevText:"« 上一页",nextText:"下一页 »",pageRange:4,pageSize:1})}else{alert("评论失败。")}}})};